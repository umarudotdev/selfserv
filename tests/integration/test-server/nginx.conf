
# Minimal nginx configuration for webserv comparison testing
daemon off;
error_log stderr info;
pid test-server/nginx.pid;

events {
    worker_connections 1024;
    use epoll;
}

http {
    # Basic MIME types
    types {
        text/html                             html htm shtml;
        text/css                              css;
        text/xml                              xml;
        image/gif                             gif;
        image/jpeg                            jpeg jpg;
        image/png                             png;
        application/javascript                js;
        application/octet-stream              bin exe dll;
        application/octet-stream              deb;
        application/octet-stream              dmg;
    }
    
    default_type application/octet-stream;
    
    access_log off;
    sendfile on;
    keepalive_timeout 65;
    server_tokens off;
    
    server {
        listen 8080 default_server;
        server_name localhost example.local test.local _;
        
        # Match webserv test configuration
        client_max_body_size 1M;
        
        # Document root
        root test-server/www;
        index index.html index.htm;
        
        # Root location
        location / {
            try_files $uri $uri/ =404;
        }
        
        # Upload endpoint - return method not allowed for now
        location /upload {
            return 405 "Method Not Allowed\n";
            add_header Content-Type text/plain;
        }
        
        # Directory listing
        location /public/ {
            autoindex on;
            autoindex_exact_size off;
            autoindex_localtime on;
        }
        
        # Redirect test
        location = /old {
            return 302 /new-location;
        }
        
        # CGI simulation
        location /cgi-bin/ {
            return 200 "CGI Test Successful\nRequest Method: GET\nServer Protocol: HTTP/1.1\n";
            add_header Content-Type text/html;
        }
        
        # API endpoint
        location /api {
            limit_except GET POST DELETE {
                return 405;
            }
            return 200 "API endpoint\n";
            add_header Content-Type text/plain;
        }
        
        # Error pages
        error_page 404 /custom_404.html;
        error_page 500 502 503 504 /custom_50x.html;
        
        location = /custom_404.html {
            internal;
        }
        
        location = /custom_50x.html {
            internal;
        }
    }
}
